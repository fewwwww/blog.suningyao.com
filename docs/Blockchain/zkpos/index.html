<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Blockchain/zkpos">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">🛰️ 读懂zkPoS: 端到端Trustless | Suning Yao / msfew | Blogs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://fewwwww.github.io/docs/Blockchain/zkpos/"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="🛰️ 读懂zkPoS: 端到端Trustless | Suning Yao / msfew | Blogs"><meta data-rh="true" name="description" content="本文为Hyper Oracle撰写, English Version: Medium."><meta data-rh="true" property="og:description" content="本文为Hyper Oracle撰写, English Version: Medium."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://fewwwww.github.io/docs/Blockchain/zkpos/"><link data-rh="true" rel="alternate" href="https://fewwwww.github.io/docs/Blockchain/zkpos/" hreflang="zh"><link data-rh="true" rel="alternate" href="https://fewwwww.github.io/docs/Blockchain/zkpos/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.ef16c1ee.css">
<link rel="preload" href="/assets/js/runtime~main.ef31b1ec.js" as="script">
<link rel="preload" href="/assets/js/main.76142136.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">blog.suningyao</b></a><a class="navbar__item navbar__link" href="/docs/intro/">About</a><a class="navbar__item navbar__link" href="/docs/Blockchain/thoughts/">Blockchain</a><a class="navbar__item navbar__link" href="/docs/Code/incubate/">Code</a><a class="navbar__item navbar__link" href="/docs/Sports/racquets/">Sports</a><a class="navbar__item navbar__link" href="/docs/Music/music-n-me/">Music</a><a class="navbar__item navbar__link" href="/docs/Life/valley/">Life</a></div><div class="navbar__items navbar__items--right"><a href="https://sny.is/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Links<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://suningyao.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Portfolio<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/fewwwww/blog.suningyao.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"><b>blog.suningyao</b></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro/">intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/Blockchain/thoughts/">🔒⛓️ Blockchain</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/thoughts/">💡 关于区块链的一些个人思考</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/zero-knowledge/">🎭 从零知识到零知识证明</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/hack-award/">🏃 组队参与黑客松的获奖情况</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/os/">❤️ WeLightOS开发的心路历程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/research-dao/">🤝 一天内组建一个研究 DAO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/erc-721/">🎨 ERC标准以及NFT应用开发</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/fisco-ubuntu/">📠 Ubuntu搭建Fisco区块链</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/solidity/">🧟‍♂️ 通过互动教程学习Solidity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/fisco-arm-mac/">💪 Arm Mac搭建Fisco区块链</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/hack-call/">🔬 调用无前端无合约的智能合约</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/cairo-0/">🇪🇬 学习Cairo智能合约开发 (零)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/reborn/">🐣 观点: Crypto 崩溃融合新生</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/composability/">🧩 观点: Crypto 破碎的可组合性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/op-zk/">🚂 观点: OP与ZK机制的差异</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/overachieve/">🔍 观点: 强化以太坊</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/rollup-diss/">🔍 观点: 批评一下 L2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/zk-criticism/">😤 观点: 批评一下 ZK</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/ai-rollup/">🤯 观点: AI Rollup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/app-chain/">🏠 读懂App-chain: 优势与缺点</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/arbitrum/">⛰️ 读懂Arbitrum: L2 第一生态</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/architecture/">🔑 读懂DApp: Web3原生架构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/arweave/">🐘 读懂Arweave: Web3 Layer 0</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/automation/">🦿 读懂Automation与Bot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/chronicle/">📖 读懂Crypto: 思潮编年史</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/dfinity/">☁️ 读懂Dfinity: 云计算+区块链</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/feed/">🥄 读懂Feed: 回到过去的 Web3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/hermez/">📐 读懂Polygon: Hermez zkEVM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/hyper-oracle-notes/">📒 读懂读懂Hyper Oracle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/hyper-oracle-posts/">👻 为Hyper Oracle所写的研究</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/hyper-oracle/">🌈 读懂Hyper Oracle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/indexing-keeper/">🗿 读懂indexing与keeper协议</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/mev/">🤖️ 读懂MEV: 描绘, 分类, 支配</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/modular/">🍱 读懂模块化: 彻底 Rollup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/next-gen-op/">👨‍⚖️ 读懂OP: OP第二代架构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/nft-redefined/">🌫 读懂NFT: 不止是艺术品</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/oracle-pos/">🤔️ 读懂预言机的不安全PoS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/pow/">⚒️ 读懂 PoW: 无处不在</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/privacy/">🎭 读懂隐私: Web3 的另一面</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/rollup/">📜 读懂Rollup: 爱恨好与坏</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/scp/">🎲 读懂SCP: 基于存储设计范式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/starkware/">🇮🇱 读懂StarkWare: 以太坊zk L2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/twap/">🧙‍♂️ 读懂TWAP: 下一代预言机</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/uniswap-interface-fee/">🤝 对于 Uniswap 前端费用的讨论</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/utxoracle/">💬 对于 UTXOracle 的讨论</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/world-supercomputer/">👾 读懂World Supercomputer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Blockchain/zkpos/">🛰️ 读懂zkPoS: 端到端Trustless</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/zkvm/">🧮 读懂zk: zk, zkEVM, zkVM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Blockchain/zkwasm/">💥 读懂zkWASM: zkVM的未来</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Code/incubate/">💄📱 Code</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Sports/racquets/">🎾🦾 Sports</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Music/music-n-me/">🎙🎧 Music</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Life/valley/">☀️👀 Life</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">🔒⛓️ Blockchain</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">🛰️ 读懂zkPoS: 端到端Trustless</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>🛰️ 读懂zkPoS: 端到端Trustless</h1><blockquote><p>本文为Hyper Oracle撰写, English Version: <a href="https://hyperoracle.medium.com/zkpos-end-to-end-trustless-65edccd87c5a" target="_blank" rel="noopener noreferrer">Medium</a>.</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="简介">简介<a href="#简介" class="hash-link" aria-label="简介的直接链接" title="简介的直接链接">​</a></h2><p>我们的<a href="https://hyperoracle.medium.com/zkwasm-the-next-chapter-of-zk-and-zkvm-471038b1fba6" target="_blank" rel="noopener noreferrer">上一篇博客</a>谈到了 zkWASM 以及为什么 zkWASM 是通用计算的最佳基础设施. zkWASM 的通用性和灵活性, 可以 100% 支持 Hyper Oracle 的索引和自动化协议中任何用户所定义的 zkGraph.</p><p>这篇博客介绍了 zkPoS 以及 zkPoS 是如何成为 Hyper Oracle 的去中心化协议中最重要的一块拼图. zkPoS 具有通过 ZK 为共识生成证明的能力, 可以实现 Hyper Oracle 索引和自动化协议的端到端去信任与安全性.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tldr">TLDR<a href="#tldr" class="hash-link" aria-label="TLDR的直接链接" title="TLDR的直接链接">​</a></h2><ul><li>Hyper Oracle 正在开发 zkPoS (通过 ZKP 来证明 Ethereum PoS 共识). zkPoS 将使 Hyper Oracle 的 zkMiddleware 实现端到端去信任.</li><li>为了实现 zkPoS 证明, 我们研究了以太坊 PoS 共识的所有关键模块和逻辑 (proposer selection algorithm, committee shuffling logic…), 并列出了它们的 SNARK 化设计.</li><li>为了验证 zkPoS 中的 BLS 签名, 我们实现了 (可能是首个) 开源的 Halo2 Pairing 库.</li><li>为了进一步提高 zkPoS Attestation 的简洁性, 我们提出了针对连续区块共识的递归证明设计.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0-以太坊-pos-共识">0. 以太坊 PoS 共识<a href="#0-以太坊-pos-共识" class="hash-link" aria-label="0. 以太坊 PoS 共识的直接链接" title="0. 以太坊 PoS 共识的直接链接">​</a></h2><p>以太坊现在所采用的是 Gasper PoS 协议.</p><p>严格意义上来说, PoS 是以太坊 2.0 抗女巫攻击的机制 (<a href="https://twitter.com/stonecoldpat0/status/1570338216946851842" target="_blank" rel="noopener noreferrer">限制谁可以参与区块生产过程</a>). <a href="https://github.com/ethereum/pos-evolution/blob/master/pos-evolution.md#gasper" target="_blank" rel="noopener noreferrer">Gasper</a> 是实际以太坊所使用的的 PoS 共识协议, 结合了 FFG Casper (finality gadget) 和 (a variation of) LMD-GHOST (fork choice rule).</p><p>就像 zk rollup 这个词比 validity rollup 这个词使用得更广泛一样, 在这篇文章中, 我们将把以太坊 2.0 的共识称为以太坊 PoS.</p><p><img loading="lazy" src="/assets/images/gasper-0d6c6d8cd0c36d85db2e4f14087efc72.png" width="2268" height="934" class="img_ev3q"></p><p>除此之外, 你也可以深入阅读 Vitalik 所写的以太坊 PoS 共识未来路线的文章: <a href="https://notes.ethereum.org/@vbuterin/single_slot_finality" target="_blank" rel="noopener noreferrer">Paths toward single-slot finality</a>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="a-以太坊-pos-概念">a) 以太坊 PoS: 概念<a href="#a-以太坊-pos-概念" class="hash-link" aria-label="a) 以太坊 PoS: 概念的直接链接" title="a) 以太坊 PoS: 概念的直接链接">​</a></h3><p>现在我们可以深入了解以太坊 PoS 的实际概念.</p><ul><li><strong>区块 (Block)</strong>: 每 12 秒产生一个区块 (或一个 Slot).</li><li><strong>纪元 (Epoch)</strong>: 一个纪元是由每 32 个连续的区块组成的, 第一个区块是一个检查点 (Checkpoint).</li><li><strong>验证人和委员会 (Validator and Committee)</strong>: 验证人的集合被划分为委员会, 每一个纪元都进行重新洗牌.</li><li><strong>验证人进入 (Validator Entrance)</strong>: 要成为一个验证者, 一个节点需要存入至少 32 个 ETH, 并处于入口队列中不少于四个纪元.</li><li><strong>验证人退出 (Validator Exit)</strong>: 要退出验证者集合并取回余额, 验证者必须在退出队列中保持不少于四个纪元. 在退出验证器集后, 仍需要等待 ~27 个小时的时间才能提取余额.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="b-以太坊-pos-committee-attestation-委员会证明">b) 以太坊 PoS: Committee Attestation (委员会证明)<a href="#b-以太坊-pos-committee-attestation-委员会证明" class="hash-link" aria-label="b) 以太坊 PoS: Committee Attestation (委员会证明)的直接链接" title="b) 以太坊 PoS: Committee Attestation (委员会证明)的直接链接">​</a></h3><p>一个给定的委员会中的每个验证者被映射到一组块中, 来验证每个纪元. 委员会则被 randao_mix 分配来验证区块.</p><p>从一个委员会到一个区块的证明包含一个代表投票的 bit-string 和一个聚合的签名 (我们将在后面的章节中讨论聚合签名的内容).</p><p>当一个检查点和上一个检查点之间的区块包含了至少 2/3 的总票数时, 该检查点就是有效的 (Justified). 一个合理的检查点在其连续的检查点 (也需要是有效的) 之后, 将被视为最终完成 (Finalized). 其他区块在最近的后续检查点被证明是合理的或被最终确定后, 就被认为是合理的或最终确定.</p><p><img loading="lazy" src="/assets/images/committee-ae3c51c06676c637fd86593fc6ce0c70.png" width="2405" height="1073" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="c-zk-attestation-zk-证明-与-committee-attestation-委员会证明">c) ZK Attestation (ZK 证明) 与 Committee Attestation (委员会证明)<a href="#c-zk-attestation-zk-证明-与-committee-attestation-委员会证明" class="hash-link" aria-label="c) ZK Attestation (ZK 证明) 与 Committee Attestation (委员会证明)的直接链接" title="c) ZK Attestation (ZK 证明) 与 Committee Attestation (委员会证明)的直接链接">​</a></h3><blockquote><p><strong>zkPoS Attestation 中的 Attestation ≠ Committee Attestation 中的 Attestation</strong></p></blockquote><p>为了避免混淆, 我们需要强调, 本节中的 &quot;Attestation &quot;本质上是对某一特定区块投票的表示, 与我们实现的全局状态的 zkPoS Attestation (ZK证明) 不同.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-zkpos-attestation-zkpos-证明">1. zkPoS Attestation (zkPoS 证明)<a href="#1-zkpos-attestation-zkpos-证明" class="hash-link" aria-label="1. zkPoS Attestation (zkPoS 证明)的直接链接" title="1. zkPoS Attestation (zkPoS 证明)的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="a-共识的验证">a) 共识的验证<a href="#a-共识的验证" class="hash-link" aria-label="a) 共识的验证的直接链接" title="a) 共识的验证的直接链接">​</a></h3><p>在学习 zkPoS 之前, 我们需要了解区块链节点不同定义的一些基本知识.</p><p>在以太坊 PoS 的背景下, <a href="https://dinoeggs.substack.com/p/easier-framing-for-blockchain-nodes" target="_blank" rel="noopener noreferrer">区块链节点的一个比较简单的定义框架</a>如下:</p><ul><li><strong>验证者 (Validator)</strong>: 构建, 提议和对有效的区块达成共识.</li><li><strong>完整节点 (Full Node)</strong>: 下载整个区块, 包括区块头和交易; 可以自行验证区块并执行状态变化.</li><li><strong>轻客户端 (Light Client/Light Node)</strong>: 只下载区块头; 可以验证 Merkle 证明以检查交易是否包含在内; 需要 &quot;信任&quot; 其他节点对于交易数据的共识.</li><li>其他类型包括 <a href="https://notes.ethereum.org/@vbuterin/pbs_censorship_resistance" target="_blank" rel="noopener noreferrer">PBS</a> 中的提议者 (Proposer) 和构建者 (Builder) 以及存档节点 (Archive Node).</li></ul><p><strong>接下来我们将只关注轻客户端, 因为<a href="https://twitter.com/VitalikButerin/status/87317738216484864" target="_blank" rel="noopener noreferrer">普通用户不会运行完整节点</a></strong>. 除了 &quot;普通用户问题&quot;, <strong>移动端、浏览器和链上合约场景只可能运行轻客户端节点</strong>.</p><p>轻客户端也有<a href="https://twitter.com/0xdinoeggs/status/1607816984472989696" target="_blank" rel="noopener noreferrer">不同类型</a>. 它们可以被划分为不同用途的验证者 (Verifier).</p><ul><li><strong>共识验证者 (Consensus Verifier)</strong>: 验证 Merkle 证明, 确保部分共识 (tx inclusion) 是有效的, 但对于整个共识仍然需要信任其他节点.</li><li><strong>状态验证者 (State Verifier)</strong>: 验证 ZK 或欺诈证明, 确保状态转换是有效的.</li><li><strong>DA 验证者 (DA Verifier)</strong>: 验证新区块交易数据的可用性.</li><li><strong>完全验证者 (Full Verifier)</strong>: 验证上述所有的共识、状态转换和 DA.</li></ul><p><img loading="lazy" src="/assets/images/verifiers-eceeb1630df9abc65bfbd2cc163f6d4c.png" width="1902" height="948" class="img_ev3q"></p><p>需要注意的是, 共识验证者轻节点仍然需要在整个共识上信任其他节点. 既然它可以验证证明, <strong>为什么不直接让它验证以太坊 PoS 整个共识的零知识证明呢</strong>?</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="b-无需信任-直接验证-zkpos-attestation">b) 无需信任, 直接验证 zkPoS Attestation<a href="#b-无需信任-直接验证-zkpos-attestation" class="hash-link" aria-label="b) 无需信任, 直接验证 zkPoS Attestation的直接链接" title="b) 无需信任, 直接验证 zkPoS Attestation的直接链接">​</a></h3><p>在 Hyper Oracle 的愿景中, 我们的目标是实现端到端的 Trustless.</p><p>我们需要<strong>实现验证以太坊 PoS 整个共识的轻节点</strong>. 在以太坊路线图 The Verge 中, 它也被称为 &quot;<a href="https://notes.ethereum.org/@domothy/roadmap#What%E2%80%99s-next2" target="_blank" rel="noopener noreferrer">SNARK-based Light Client</a>&quot;.</p><p>zkPoS Attestation 的优点是:</p><ul><li><strong>无需信任</strong>: 去除以太坊轻节点对其他节点的额外信任, 实现完全无需信任.</li><li><strong>去中心化</strong>: 以太坊节点不需要依赖中心化的服务来给他们提供区块头或其他数据.</li><li><strong>低开销</strong>: 对 zkPoS Attestation 的验证是高效的, 只需要很小的开销.</li></ul><p>ZK 化的轻客户端将验证我们的 zkPoS Attestation 的ZKP. 它可以非常容易地在 Web App 或浏览器的插件中运行.</p><p><strong>验证 zkPoS Attestation 将是使我们的 zkMiddleware 完全 ZK 化的重要基础</strong>. 它将使我们的 Meta App zkIndexing (基于 GraphQL 的 Trustless 索引和查询) 和 zkAutomation (基于 GraphQL Off-chain Source 的 Trustless Automation 和 Keeper) 能够访问和同步有效的区块头.</p><p>之后, 我们可以通过有效的区块头抓取 receipt, state, 和 transaction 根. 在 zkIndexing 中, 我们获取 receiptRoot, 然后获取收据的编码数据, 最后根据收据的原始数据用 RLP 解码获得合同事件.</p><p><img loading="lazy" src="/assets/images/roots-3b380a25caac07bf72f83682ead46e01.png" width="2024" height="568" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-hyper-oracle-的-zkpos">2. Hyper Oracle 的 zkPoS<a href="#2-hyper-oracle-的-zkpos" class="hash-link" aria-label="2. Hyper Oracle 的 zkPoS的直接链接" title="2. Hyper Oracle 的 zkPoS的直接链接">​</a></h2><p>以太坊 PoS 的算法非常复杂, 很难用一个简单的图表或一个段落来描述. 而且, 以 ZK 的方式实现它们需要大量的工程工作和架构设计 (就像 zkEVM). 因此, 为了实现 zkPoS, 有必要将这些组件分割开来, 逐一实践它们.</p><p><strong>zkPoS 最优先的算法是 Block Attestation.</strong> 换句话说, <strong>通过 Pairing 验证 BLS 签名是 zkPoS 最关键的部分</strong>. 我们将在后面的章节中详细介绍这部分内容.</p><p>简而言之, 对于 Hyper Oracle 的 zkPoS, 我们将实现以太坊 PoS 的如下算法.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="a-基于随机性的算法">a) 基于随机性的算法<a href="#a-基于随机性的算法" class="hash-link" aria-label="a) 基于随机性的算法的直接链接" title="a) 基于随机性的算法的直接链接">​</a></h3><ul><li><strong>提议者选择算法 (Proposer Selection Algorithm)</strong></li></ul><p>几个纪元前的随机种子将决定每个区块的提议者.</p><p>这个算法的底层组件之一是洗牌算法, 它也将被在下一个逻辑中应用.</p><ul><li><strong>委员会洗牌算法 (Committee Shuffling Logic)</strong></li></ul><p>每个纪元, 通过随机种子和洗牌算法, 整个验证者集合被重新洗牌为不同的委员会.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="b-验证者相关算法">b) 验证者相关算法<a href="#b-验证者相关算法" class="hash-link" aria-label="b) 验证者相关算法的直接链接" title="b) 验证者相关算法的直接链接">​</a></h3><ul><li><strong>验证者进入 (Validator Entrance)</strong></li></ul><p>验证者候选者: 任何节点存款 ≥32ETH 则可成为验证者候选人.</p><p>正式验证者: 在一个验证者候选者进入队列不少于 4 个纪元后, 它将被激活为正式验证者.</p><ul><li><strong>验证者退出 (Validator Exiting)</strong></li></ul><p>要离开验证器集并提取余额, 一个节点必须进入退出队列时间不少于4个纪元. 这种验证器的退出可以由自愿退出或因行为不端而被 Slashing 所触发.</p><p>特别是, 有效余额低于 16ETH 的验证器将被停用.</p><p><img loading="lazy" src="/assets/images/queue-c8f77de10ec4c9711bff99d03001ceea.png" width="2032" height="709" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="c-block-attestation-算法">c) Block Attestation 算法<a href="#c-block-attestation-算法" class="hash-link" aria-label="c) Block Attestation 算法的直接链接" title="c) Block Attestation 算法的直接链接">​</a></h3><p>一个区块只有在该纪元的相应委员会成员有多数 (2/3) 赞成该区块的投票时才会被认证.</p><p>这是以集合签名和代表投票的 bit-string 的形式实现的, 其中当且仅当相应的验证人投票时, 每个 bit 都是 1.</p><p><img loading="lazy" src="/assets/images/attest-9d79736f7deac35fbf56d66abf9a5269.png" width="1375" height="930" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="d-其他逻辑">d) 其他逻辑<a href="#d-其他逻辑" class="hash-link" aria-label="d) 其他逻辑的直接链接" title="d) 其他逻辑的直接链接">​</a></h3><p>要注意的是, 本文所列出的的变量和推理过程是最重要的组成部分, 但要完全证明一个区块还需要更多的内容. 例如, 随机性和有效余额 (effective balance) 不是可以通过简单的计算直接产生的.</p><ul><li>随机性</li></ul><p>随机性是指在每个区块中, 将签名 (randao_reveal) 与随机源 (randao_mix) 混合, 以确定之后的区块中的随机数.</p><ul><li>有效余额</li></ul><p>验证者的有效余额需要不断更新, 余额不足的验证器将被视为无效.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="e-一图看懂-zkpos">e) 一图看懂 zkPoS<a href="#e-一图看懂-zkpos" class="hash-link" aria-label="e) 一图看懂 zkPoS的直接链接" title="e) 一图看懂 zkPoS的直接链接">​</a></h3><p>由于以太坊现有的 PoS 共识的复杂性, 我们提供了这个总结上述逻辑的图表. 两列各代表了两个相邻区块的数据.</p><p>其中, 左边第一个区块是一个检查点. 该图包括从检查点块到其下一个块的状态转换的部分必要算法. 每个箭头都对应于至少一个对 zkPoS Attestation 的约束.</p><p><img loading="lazy" src="/assets/images/pos-f7e4e1753e9bc5f061d09d4692e989d0.png" width="2532" height="1356" class="img_ev3q"></p><p>在这个图中, 为了方便理解, 我们省略了有效余额和表示索引是否有效的 Boolean 数组.</p><p>请注意:</p><ul><li>委员会成员是根据一定纪元前的随机数选择的.</li><li>进入和出口队列是根据最新的存款、Slashing 和自愿退出从而更新的.</li><li>四个纪元前加入的进入/出口队列中的验证人将离开队列, 转换为激活状态中或停用的.</li><li>第二个区块由相应的 Committee Attestation 来证明, 这些证明存储在未来的区块中.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-zkpos-bls">3. zkPoS: BLS<a href="#3-zkpos-bls" class="hash-link" aria-label="3. zkPoS: BLS的直接链接" title="3. zkPoS: BLS的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="a-pos-中的-bls-签名">a) <a href="https://eth2book.info/bellatrix/part2/building_blocks/signatures/#the-building-blocks" target="_blank" rel="noopener noreferrer">PoS 中的 BLS 签名</a><a href="#a-pos-中的-bls-签名" class="hash-link" aria-label="a-pos-中的-bls-签名的直接链接" title="a-pos-中的-bls-签名的直接链接">​</a></h3><p>在以太坊 PoS 协议中, 使用了基于 BLS12-381 椭圆曲线的 BLS 签名, 而不是基于 secp256k1 椭圆曲线的ECDSA (用于用户交易签名).</p><p>以下是选择基于 BLS12-381 的 BLS 的一些理由:</p><ol><li>为什么是BLS? <strong>BLS 具有 Pairing 的特殊属性</strong>.</li><li>为什么要 Pairing? <strong>Pairing 允许签名被聚合</strong>.</li><li>为什么要聚合? 尽管与 ECDSA 相比, 配对操作让 BLS 签名的验证变得更加资源密集和昂贵, 但其好处是:<ul><li><strong>时间</strong>: 在一次签名验证操作中验证所有 Attestation. (仅用两个配对和椭圆曲线点加法来验证 N 个签名).</li><li><strong>空间</strong>: 将所有签名的 N 个字节缩减为总签名的 1/N 个字节 (理想情况下).</li><li><strong>当签名的数量比较大时, 优化效果就会累积起来</strong>.</li></ul></li><li>为什么用 BLS12-381? <strong>BLS12-381是<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-pairing-friendly-curves-10" target="_blank" rel="noopener noreferrer">一个配对友好的椭圆曲线</a>, 具有 <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-pairing-friendly-curves-10#name-for-128-bit-security" target="_blank" rel="noopener noreferrer">128 位安全性</a></strong>.</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="b-验证-bls-签名">b) <a href="https://eth2book.info/bellatrix/part2/building_blocks/signatures/#verifying" target="_blank" rel="noopener noreferrer">验证 BLS 签名</a><a href="#b-验证-bls-签名" class="hash-link" aria-label="b-验证-bls-签名的直接链接" title="b-验证-bls-签名的直接链接">​</a></h3><p>为了<strong>验证 BLS 签名</strong>, 我们需要三个输入:</p><ul><li><strong>BLS 签名本身</strong> (将签名进行椭圆曲线点相加, 并得到代表 96 字节签名的最终点.)</li><li><strong>聚合公钥</strong> (验证者的原始公钥可以在信标链状态中找到. 然后将它们 “添加” 在一起.)</li><li><strong>信息</strong></li></ul><p><img loading="lazy" src="/assets/images/bls-sig-18aab2687cd2db9493d17ae5e29e8700.png" width="2550" height="1424" class="img_ev3q"></p><p>在我们前面讨论轻客户端的部分中, 我们知道我们最常见的场景是移动端、浏览器和链上. 在这些场景中, 进行验证计算, 包括聚合公钥和验证 BLS 签名 (带 Pairing 检查的椭圆曲线加法) 是昂贵的. <strong>幸运的是, 验证 ZKP, 或者具体来说, 验证 zkPoS Attestation 是很便宜的</strong>.</p><p><img loading="lazy" src="/assets/images/verify-4d6834eea00aa227c5362dc3e7397d35.png" width="1594" height="260" class="img_ev3q"></p><p><strong>使用 BLS12-381 曲线验证 BLS 签名是 zkPoS Attestation 的关键组件之一</strong>.</p><p>如此昂贵的验证所需的计算能力可以外包给 zkPoS Attestation prover. 一旦生成证明, 就不需要其他计算. 然后, <strong>客户端只需要验证 ZKP</strong>. 就这么简单.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="c-bls12-381-的更多知识">c) BLS12-381 的更多知识<a href="#c-bls12-381-的更多知识" class="hash-link" aria-label="c) BLS12-381 的更多知识的直接链接" title="c) BLS12-381 的更多知识的直接链接">​</a></h3><p><a href="https://eth2book.info/bellatrix/part2/building_blocks/signatures/#see-also" target="_blank" rel="noopener noreferrer">一个有趣的事实</a>是 “BLS 签名” 中的 BLS 是 Boneh、Lynn 和 Shacham, 而 “BLS12-381” 的 BLS 是 Barreto、Lynn 和 Scott.</p><p>BLS12-381 中的 12 是<a href="https://hackmd.io/@benjaminion/bls12-381#Motivation" target="_blank" rel="noopener noreferrer">曲线的嵌入度</a>.</p><p>BLS12-381 中的 381 是<a href="https://hackmd.io/@benjaminion/bls12-381#Motivation" target="_blank" rel="noopener noreferrer">表示曲线上坐标所需的位数</a>.</p><p>BLS12-381 的曲线实际上是两条曲线: G1 和 G2. 除了深入研究这些曲线的数学部分, 一些 <a href="https://hackmd.io/@benjaminion/bls12-381#Swapping-G1-and-G2" target="_blank" rel="noopener noreferrer">BLS 签名工程上的设计</a>是:</p><ul><li>G1 比 G2 更快, <a href="https://medium.com/asecuritysite-when-bob-met-alice/explaining-bls12-381-the-zero-knowledge-proof-curve-aa5eabec8261" target="_blank" rel="noopener noreferrer">需要更少内存</a>, 因为计算层面 field 更小.</li><li>Zcash 选择签名使用 G1, 公钥使用 G2.</li><li>以太坊 PoS 选择公钥使用 G1 作为公钥, 签名使用 G2. 原因是公钥的聚合发生得更频繁, 并且公钥存储在需要更小表示的状态中.</li></ul><p>两条曲线之间的椭圆曲线配对称为双线性映射. 本质上就是是我们映射 G1 X G2 → Gt. 你可以在 <a href="https://vitalik.ca/general/2017/01/14/exploring_ecp.html" target="_blank" rel="noopener noreferrer">Vitalik 的帖子</a>中了解更多信息.</p><p><a href="https://alonmuroch-65570.medium.com/bls-signatures-part-2-key-concepts-of-pairings-27a8a9533d0c" target="_blank" rel="noopener noreferrer">以更简单的话来说</a>, <strong>Pairing 是一种验证 BLS 签名所涉及到的特殊乘法</strong>. Pairing 是 zkPoS Attestation 的 BLS 签名的验证部分所必备的.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-zkpos-halo2-pairing-for-bls">4. zkPoS: Halo2 Pairing for BLS<a href="#4-zkpos-halo2-pairing-for-bls" class="hash-link" aria-label="4. zkPoS: Halo2 Pairing for BLS的直接链接" title="4. zkPoS: Halo2 Pairing for BLS的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="a-已有实现">a) 已有实现<a href="#a-已有实现" class="hash-link" aria-label="a) 已有实现的直接链接" title="a) 已有实现的直接链接">​</a></h3><p>有许多关于 BLS12-381 Pairing 的开源实现. 它们可以作为 BLS 签名验证的重要组成部分.</p><ul><li><strong>用于以太坊 PoS 客户端</strong>: <a href="https://github.com/supranational/blst" target="_blank" rel="noopener noreferrer">blst</a> by supranational</li><li><strong>用于学习</strong>: <a href="https://github.com/paulmillr/noble-bls12-381" target="_blank" rel="noopener noreferrer">noble-bls12-381</a> by Paul Miller</li></ul><p>另外, 还有一些用 ZK 语言实现的:</p><ul><li><strong>用于 Circom</strong>: <a href="https://github.com/yi-sun/circom-pairing" target="_blank" rel="noopener noreferrer">circom-pairing</a> by 0xPARC (<a href="https://0xparc.org/blog/zk-pairing-1" target="_blank" rel="noopener noreferrer">part1 post</a>, <a href="https://0xparc.org/blog/zk-pairing-2" target="_blank" rel="noopener noreferrer">part2 post</a>)</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="b-hyper-oracle-的-halo2-pairing">b) Hyper Oracle 的 Halo2 Pairing<a href="#b-hyper-oracle-的-halo2-pairing" class="hash-link" aria-label="b) Hyper Oracle 的 Halo2 Pairing的直接链接" title="b) Hyper Oracle 的 Halo2 Pairing的直接链接">​</a></h3><p>回顾一下, 我们需要用 ZK 语言来实现 Pairing, 因为我们将用我们的 zkPoS Attestation 来证明 PoS. BLS 签名验证是 zkPoS 证明的重要组成部分, 而 BLS12-381 的 Pairing 是 BLS 签名验证的基础.</p><p>如果你读了我们的<a href="https://hyperoracle.medium.com/zkwasm-the-next-chapter-of-zk-and-zkvm-471038b1fba6" target="_blank" rel="noopener noreferrer">关于zkWASM的上一篇文章</a>, 你可能会想, 为什么我们不直接使用现有的实现? 下面是我们的思考过程:</p><ul><li><strong>重复使用 Rust/C/... 的实现</strong>: 开箱即用的解决方案, 但是在没有优化的情况下, 直接在 zkWASM 中运行它们的性能可能不是最佳的.</li><li><strong>重复使用 circom 的实现</strong> (circom-pairing): 也是开箱即用, 且<a href="https://medium.com/veridise/circom-pairing-a-million-dollar-zk-bug-caught-early-c5624b278f25" target="_blank" rel="noopener noreferrer">审计过的</a>. 更多的比较将会在下一节介绍.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="c-halo2-pairing-与-circom-pairing-的比较">c) Halo2 Pairing 与 circom-pairing 的比较<a href="#c-halo2-pairing-与-circom-pairing-的比较" class="hash-link" aria-label="c) Halo2 Pairing 与 circom-pairing 的比较的直接链接" title="c) Halo2 Pairing 与 circom-pairing 的比较的直接链接">​</a></h3><p>circom-pairing 为 circom 中的 BLS12-381 曲线提供了一个很好的 Pairing PoC 实现. 在 Succinct Labs 的 <a href="https://github.com/succinctlabs/eth-proof-of-consensus" target="_blank" rel="noopener noreferrer">Proof of Consensus trustless bridge</a> 中, 它被用于 BLS 签名验证.</p><p>而我们不使用 circom-pairing 的原因是:</p><ul><li><strong>产品方面</strong>: circom-pairing 会让达成客制化和通用性更加难. zkIndexing 和 zkAutomation 是基于用户定义的 zkGraph (定义如何提取区块链数据, 并将其处理到 Hyper Oracle 节点中), 因此必须支持zkGraph语法中的任何逻辑. 这一点与技术栈的理由密切相关.</li><li><strong>技术栈方面</strong>: circom-pairing 与 zkWASM 的 Plonkish 约束系统不兼容. circom 实现的 circom-pairing 编译为 R1CS, 很难与我们的 Plonkish 约束系统相结合 (使用 <a href="https://anoma.net/blog/a-vamp-ir-s-guide-to-arithmetic-circuits-and-perfectly-boiled-eggs/" target="_blank" rel="noopener noreferrer">VampIR</a> 这样的工具会增加我们系统的复杂性). 另外, R1CS 对于证明批处理 (Proof Batching) 来说并不完美 (当然是可行的).</li><li><strong>性能方面</strong>: 证明生成速度方面, 我们的 Halo2 Pairing 实现要比 circom-pairing 快得多. 在 gas fee 方面, 我们的 Halo2 Pairing 电路可以很容易地与 zkWASM 电路结合 (Halo2 Pairing 是 Plonkish, 而 circom-pairing 是 R1CS), 所以使用 Halo2 Pairing 的费用会低很多.</li></ul><p>更简单地说, 如果我们必须使用 circom-pairing 进行 BLS 签名验证, 对我们来说, 一些缺点主要是:</p><ol><li>与我们现有的 zk 电路<strong>不兼容</strong>, 包括 zkWASM</li><li><strong>不利于产品在 zkGraph 上的完全通用性和定制能力</strong></li><li>或者<strong>给我们的系统增加了不必要的复杂性</strong></li><li>而且<strong>性能可能不是最佳的</strong></li></ol><p>具体区别如下:</p><p><img loading="lazy" src="/assets/images/halo2-why-b71268a9ddacf8e50e14726474241af5.png" width="2188" height="972" class="img_ev3q"></p><p><strong>我们最终的技术栈是, zkWASM 用于定制逻辑 (zkGraph), Halo2 Pairing 作为 Foreign 电路 (BLS 与 BLS12-381)</strong>. 它同时满足了通用性 (对于用户定义的 zkGraph) 和性能 (对于整个zk系统).</p><p><strong>我们很高兴我们有了自己的 Halo2 Pairing 库的实现 (可能是目前市面上第一个开源实现)</strong>. Halo2 Pairing 将为 zkPoS Attestation 提供基础. 它是完全开源的, 你可以在<a href="https://github.com/DelphinusLab/halo2ecc-s/tree/pairing" target="_blank" rel="noopener noreferrer">这里</a>看源码与提 PR. 下面是一些更详细的技术细节和 benchmark.</p><p><img loading="lazy" src="/assets/images/halo2-benchmark-2d38ebf4fb6d8bf32afaf568bd100ae0.png" width="2360" height="1014" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5-zkpos-递归证明">5. zkPoS: 递归证明<a href="#5-zkpos-递归证明" class="hash-link" aria-label="5. zkPoS: 递归证明的直接链接" title="5. zkPoS: 递归证明的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="a-zk-递归">a) ZK 递归<a href="#a-zk-递归" class="hash-link" aria-label="a) ZK 递归的直接链接" title="a) ZK 递归的直接链接">​</a></h3><p>zkPoS 的另一个关键点是递归证明.</p><p>递归证明本质上是证明的证明 (证明 B 时验证证明 A ). 我们的 Halo2 Pairing 也可能会在其中发挥作用, 因为 BLS12-381 是 &quot;<a href="https://medium.com/asecuritysite-when-bob-met-alice/explaining-bls12-381-the-zero-knowledge-proof-curve-aa5eabec8261" target="_blank" rel="noopener noreferrer">零知识证明曲线</a>&quot;.</p><p>一般来说，递归证明的<a href="https://www.youtube.com/watch?v=VmYpbFxBdtM" target="_blank" rel="noopener noreferrer">主要优势</a>如下:</p><ul><li>压缩 <strong>(aka 简洁)</strong>:<ul><li>将更多的知识 &quot;Rollup&quot; 到一个输出的单一证明中.</li><li>例如: 验证开销(第 N+1 个证明, 证明第 0-N 次的正确性) &lt; 验证开销(第 0-N 个证明)</li></ul></li></ul><p><img loading="lazy" src="/assets/images/recursive-why-b3e7e53a3d457223d083e4561c4da7b6.png" width="2360" height="914" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="b-为什么-zkpos-需要递归证明">b) 为什么 zkPoS 需要递归证明?<a href="#b-为什么-zkpos-需要递归证明" class="hash-link" aria-label="b) 为什么 zkPoS 需要递归证明?的直接链接" title="b) 为什么 zkPoS 需要递归证明?的直接链接">​</a></h3><p>当处理<a href="https://bitcoin.org/bitcoin.pdf" target="_blank" rel="noopener noreferrer">区块链</a>共识时, 对递归证明的需求会变大.</p><p><strong>I. PoW 和 PoS 的递归证明</strong></p><p>对于一个 PoW 共识的网络: 从最高的区块开始, 我们将递归地检查它之前的哈希值、nonce 和难度, 直到到达我们定义的起始区块. 我们将在下一节中用公式演示该算法.</p><p>对于像以太坊这样具有 PoS 共识的网络: 情况会更复杂. 我们需要根据前一个区块的验证者集合和投票来检查每个区块的共识, 直到追溯到一个没有争议的历史区块 (如以太坊 PoS 信标链的创世区块).</p><p><strong>II. PoW 递归证明的效果</strong></p><p>下图展示了共识的递归证明在将更多信息压缩到单一证明中的效果, 以 PoW 为例.</p><p><img loading="lazy" src="/assets/images/recursive-f861e868bc8e57c155bc446ad63d9bd2.png" width="2614" height="502" class="img_ev3q"></p><p><strong>III. 使用/不使用递归证明</strong></p><p>如果没有递归证明, 我们最终会输出 O(区块高度) 大小的证明来进行验证, 即每个块证明的公共输入和每个块的证明.</p><p>有了递归证明, 除了初始和最终状态的公共输入, 我们将有一个 O(1) 针对任何数量的块的证明, 即第一个和最后一个公共输入, 连同递归证明 $\mathsf{pk}_r$. 一个自然的问题是, 所有的中间公共输入都去哪儿了? 答案是, 它们已经成为 ZK argument 的 existential quantifiers, 因此被消除了. 简单来说, 更多的知识被递归证明压缩到了证明中.</p><p><strong>IV. 递归证明对 Hyper Oracle 的效果</strong></p><p>需要记住, 我们面对的是有更多计算和内存限制的 &quot;轻客户端&quot; (浏览器), 即使每个证明可以在恒定的时间内 (比如 1 或 2 秒) 验证. 如果区块和证明的数量加起来, 验证时间将非常长.</p><p>在 Hyper Oracle 的 zkAutomation 中, 可能有跨多块进行自动化操作的情况, 比如在套利策略或自动风险管理等场景下. 那么为了实现这样的应用, PoS 共识的递归证明是必须的.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="c-hyper-oracle-的递归证明">c) Hyper Oracle 的递归证明<a href="#c-hyper-oracle-的递归证明" class="hash-link" aria-label="c) Hyper Oracle 的递归证明的直接链接" title="c) Hyper Oracle 的递归证明的直接链接">​</a></h3><p>为了便于表述和理解, 本节已被简化, 并不代表确切实现.</p><p>理论上, 对于两个连续区块的递归证明, PoW (PoS 的情况太复杂, 不能浓缩到一个共识) 的递归证明如下:</p><p><img loading="lazy" src="/assets/images/pok-0-39c229af331961dd441360642b07ec9e.png" width="1036" height="213" class="img_ev3q"></p><p>在将中间的公共变量 (即 h_1, pk_2, 和 preHash_2) 改为 Witness 后, 两个证明可以合并为一个证明, 如下图所示:</p><p><img loading="lazy" src="/assets/images/pok-1-8980ba22e290272046d7397d4080896e.png" width="1026" height="248" class="img_ev3q"></p><p>我们可以观察到, 公共输入只有 h_2、pk_1 和 preHash_1. 当有两个以上的区块时, 例如 n 个区块, 我们可以应用同样的技巧进行 n-1 次递归, 为 n 个区块最终生成一个证明, 同时只保留第一个 pk_1 和 preHash_1 的公共输入, 以及最后的区块哈希 h_n.</p><p>类似于这个 PoW 例子的递归证明的算法将被应用, 用于保证 Hyper Oracle 的 zkPoS Attestation 对任意区块数证明的简洁和恒定大小. 请注意, 在当前阶段, zkGraph 的定制逻辑不包括在这个递归证明中.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6-端到端-trustless-之路">6. 端到端 Trustless 之路<a href="#6-端到端-trustless-之路" class="hash-link" aria-label="6. 端到端 Trustless 之路的直接链接" title="6. 端到端 Trustless 之路的直接链接">​</a></h2><p>我们即将发布的黄皮书将提供更多关于 Hyper Oracle zkPoS Attestation 的规格和实施细节.</p><p>总而言之, zkPoS 是基于我们以下独特的技术栈:</p><ul><li>zkWASM, 用于为用户定义的 zkGraph 提供100%的定制化通用性</li><li>Foreign 电路, 包括 Halo2 Pairing 等</li><li>递归证明</li></ul><p>Hyper Oracle 非常期待利用 zkPoS 实现端到端的无信任索引和自动化 Meta App, 以及通过我们的 zkMiddleware 使下一代应用程序做到真正去中心化.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Blockchain/world-supercomputer/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">👾 读懂World Supercomputer</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Blockchain/zkvm/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">🧮 读懂zk: zk, zkEVM, zkVM</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#简介" class="table-of-contents__link toc-highlight">简介</a></li><li><a href="#tldr" class="table-of-contents__link toc-highlight">TLDR</a></li><li><a href="#0-以太坊-pos-共识" class="table-of-contents__link toc-highlight">0. 以太坊 PoS 共识</a><ul><li><a href="#a-以太坊-pos-概念" class="table-of-contents__link toc-highlight">a) 以太坊 PoS: 概念</a></li><li><a href="#b-以太坊-pos-committee-attestation-委员会证明" class="table-of-contents__link toc-highlight">b) 以太坊 PoS: Committee Attestation (委员会证明)</a></li><li><a href="#c-zk-attestation-zk-证明-与-committee-attestation-委员会证明" class="table-of-contents__link toc-highlight">c) ZK Attestation (ZK 证明) 与 Committee Attestation (委员会证明)</a></li></ul></li><li><a href="#1-zkpos-attestation-zkpos-证明" class="table-of-contents__link toc-highlight">1. zkPoS Attestation (zkPoS 证明)</a><ul><li><a href="#a-共识的验证" class="table-of-contents__link toc-highlight">a) 共识的验证</a></li><li><a href="#b-无需信任-直接验证-zkpos-attestation" class="table-of-contents__link toc-highlight">b) 无需信任, 直接验证 zkPoS Attestation</a></li></ul></li><li><a href="#2-hyper-oracle-的-zkpos" class="table-of-contents__link toc-highlight">2. Hyper Oracle 的 zkPoS</a><ul><li><a href="#a-基于随机性的算法" class="table-of-contents__link toc-highlight">a) 基于随机性的算法</a></li><li><a href="#b-验证者相关算法" class="table-of-contents__link toc-highlight">b) 验证者相关算法</a></li><li><a href="#c-block-attestation-算法" class="table-of-contents__link toc-highlight">c) Block Attestation 算法</a></li><li><a href="#d-其他逻辑" class="table-of-contents__link toc-highlight">d) 其他逻辑</a></li><li><a href="#e-一图看懂-zkpos" class="table-of-contents__link toc-highlight">e) 一图看懂 zkPoS</a></li></ul></li><li><a href="#3-zkpos-bls" class="table-of-contents__link toc-highlight">3. zkPoS: BLS</a><ul><li><a href="#a-pos-中的-bls-签名" class="table-of-contents__link toc-highlight">a) PoS 中的 BLS 签名</a></li><li><a href="#b-验证-bls-签名" class="table-of-contents__link toc-highlight">b) 验证 BLS 签名</a></li><li><a href="#c-bls12-381-的更多知识" class="table-of-contents__link toc-highlight">c) BLS12-381 的更多知识</a></li></ul></li><li><a href="#4-zkpos-halo2-pairing-for-bls" class="table-of-contents__link toc-highlight">4. zkPoS: Halo2 Pairing for BLS</a><ul><li><a href="#a-已有实现" class="table-of-contents__link toc-highlight">a) 已有实现</a></li><li><a href="#b-hyper-oracle-的-halo2-pairing" class="table-of-contents__link toc-highlight">b) Hyper Oracle 的 Halo2 Pairing</a></li><li><a href="#c-halo2-pairing-与-circom-pairing-的比较" class="table-of-contents__link toc-highlight">c) Halo2 Pairing 与 circom-pairing 的比较</a></li></ul></li><li><a href="#5-zkpos-递归证明" class="table-of-contents__link toc-highlight">5. zkPoS: 递归证明</a><ul><li><a href="#a-zk-递归" class="table-of-contents__link toc-highlight">a) ZK 递归</a></li><li><a href="#b-为什么-zkpos-需要递归证明" class="table-of-contents__link toc-highlight">b) 为什么 zkPoS 需要递归证明?</a></li><li><a href="#c-hyper-oracle-的递归证明" class="table-of-contents__link toc-highlight">c) Hyper Oracle 的递归证明</a></li></ul></li><li><a href="#6-端到端-trustless-之路" class="table-of-contents__link toc-highlight">6. 端到端 Trustless 之路</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro/">About</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Blockchain/thoughts/">Blockchain</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Code/incubate/">Code</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Sports/racquets/">Sports</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Music/music-n-me/">Music</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Life/valley/">Life</a></li></ul></div><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://sny.is/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linktree<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://fewwwww.github.io/WeChat-AddMe/" target="_blank" rel="noopener noreferrer" class="footer__link-item">WeChat<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://suningyao.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Portfolio<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/fewwwww/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">💗Thank U for reading~💗</div><ul class="footer__items clean-list"></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Suning Yao's Blog. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ef31b1ec.js"></script>
<script src="/assets/js/main.76142136.js"></script>
</body>
</html>