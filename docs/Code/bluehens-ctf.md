# ðŸ¥· OffSec CTF Writeupä½“éªŒ

> å› ä¸ºä¸Šè¯¾è¦æ±‚è¦æ‰“ä¸€é“ CTF ä»¥åŠå†™ä¸€ä¸ª writeup, æ‰€ä»¥åœ¨ ctftime é¦–é¡µä¸Šçœ‹äº†å‡ ä¸ªæ­£åœ¨è¿›è¡Œçš„ CTF, çœ‹åˆ°[è¿™ä¸ª](https://ctftime.org/event/1738)é‡Œçš„[è¿™é“é¢˜](https://bluehens.ctfd.io/challenges#Perhaps%20You%20Can-71).

## ðŸ“ é¢˜ç›®

Perhaps You Can

`550d0d0a00000000b7e8566370030000e300000000000000000000000000000000080000004000000073300200006500640083015a0165026501830164016b02731c650364028301010065046501a005a100830164036b02733465036402830101006501640464058502190064066b02734c650364028301010065016407190064086b027360650364028301010065066501640919008301640a1800650665016405190083016b02738465036402830101006501640b190065076508650965066501640c19008301830164046404640785031900830183016b0273b6650364028301010065066501640b19008301640d180065066501640d190083016b0273da650364028301010065066501640e190083015a0a65066501640f190083015a0b650a650b170064106b02900173086503640283010100650c650a650b830264116b0090017320650364028301010065016412641385021900a005a100a00da10064146b029001734265036402830101006501641319006501641519006b029001735c65036402830101006501641519006501641619006b029001737665036402830101006506650164171900830165066501641819008301140064196b029001739c650364028301010065066501641a1900830165066501641b19008301140065066501641c190083011400641d6b02900173ce6503640283010100650e641ea00f6510641f64208400650164216422850219008302a10183015a116511a012a1000100641ea00f6511a10164236b029002730e650364028301010065016424190064256b0290027324650364028301010065136426830101006404530029277a07696e7075743e20e926000000e90100000069d20d00004ee9060000007a0655444354467be9fffffffffa017de905000000e902000000e907000000e903000000e909000000e908000000e90a000000e9eb000000e977000000e90b000000e9180000005a1a3333356636323333363536653566363237393734373433333665e91b000000e91f000000e919000000e91a00000069522e0000e91c000000e91d000000e91e0000006960630900da0063010000000000000000000000010000000300000043000000730c000000740074017c0083018301530029014e2902da03737472da036f72642901da0178a900721c000000fa087472796d652e7079da083c6c616d6264613e20000000f300000000721e000000e920000000e9250000005a0e3030303131313131313132353537e922000000da01347a07596f752077696e2914da05696e707574da03746d70da036c656eda0465786974da0373756dda06656e636f6465721a000000da03636872da03696e747219000000721b000000da0179da036d6178da03686578da046c697374da046a6f696eda036d6170da027979da04736f7274da057072696e74721c000000721c000000721c000000721d000000da083c6d6f64756c653e01000000734a00000008010c01080110010801100108010c0108011c0108012a0108011c0108010c010c010e010801100108011a01080112010801120108011e0108012a01080120010801100108010e010801`

## ðŸ§ ç­”æ¡ˆ

æ‹¿åˆ°æ•°å­—åŽ, è§‚å¯Ÿå³å¯çŸ¥é“, è¿™æ˜¯ä¸€ä¸ªåå…­è¿›åˆ¶çš„å­—ç¬¦ä¸², äºŽæ˜¯æ”¾åˆ° [CyberChef](https://gchq.github.io/CyberChef/#recipe=From_Hex('Auto')&input=NTUwZDBkMGEwMDAwMDAwMGI3ZTg1NjYzNzAwMzAwMDBlMzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDgwMDAwMDA0MDAwMDAwMDczMzAwMjAwMDA2NTAwNjQwMDgzMDE1YTAxNjUwMjY1MDE4MzAxNjQwMTZiMDI3MzFjNjUwMzY0MDI4MzAxMDEwMDY1MDQ2NTAxYTAwNWExMDA4MzAxNjQwMzZiMDI3MzM0NjUwMzY0MDI4MzAxMDEwMDY1MDE2NDA0NjQwNTg1MDIxOTAwNjQwNjZiMDI3MzRjNjUwMzY0MDI4MzAxMDEwMDY1MDE2NDA3MTkwMDY0MDg2YjAyNzM2MDY1MDM2NDAyODMwMTAxMDA2NTA2NjUwMTY0MDkxOTAwODMwMTY0MGExODAwNjUwNjY1MDE2NDA1MTkwMDgzMDE2YjAyNzM4NDY1MDM2NDAyODMwMTAxMDA2NTAxNjQwYjE5MDA2NTA3NjUwODY1MDk2NTA2NjUwMTY0MGMxOTAwODMwMTgzMDE2NDA0NjQwNDY0MDc4NTAzMTkwMDgzMDE4MzAxNmIwMjczYjY2NTAzNjQwMjgzMDEwMTAwNjUwNjY1MDE2NDBiMTkwMDgzMDE2NDBkMTgwMDY1MDY2NTAxNjQwZDE5MDA4MzAxNmIwMjczZGE2NTAzNjQwMjgzMDEwMTAwNjUwNjY1MDE2NDBlMTkwMDgzMDE1YTBhNjUwNjY1MDE2NDBmMTkwMDgzMDE1YTBiNjUwYTY1MGIxNzAwNjQxMDZiMDI5MDAxNzMwODY1MDM2NDAyODMwMTAxMDA2NTBjNjUwYTY1MGI4MzAyNjQxMTZiMDA5MDAxNzMyMDY1MDM2NDAyODMwMTAxMDA2NTAxNjQxMjY0MTM4NTAyMTkwMGEwMDVhMTAwYTAwZGExMDA2NDE0NmIwMjkwMDE3MzQyNjUwMzY0MDI4MzAxMDEwMDY1MDE2NDEzMTkwMDY1MDE2NDE1MTkwMDZiMDI5MDAxNzM1YzY1MDM2NDAyODMwMTAxMDA2NTAxNjQxNTE5MDA2NTAxNjQxNjE5MDA2YjAyOTAwMTczNzY2NTAzNjQwMjgzMDEwMTAwNjUwNjY1MDE2NDE3MTkwMDgzMDE2NTA2NjUwMTY0MTgxOTAwODMwMTE0MDA2NDE5NmIwMjkwMDE3MzljNjUwMzY0MDI4MzAxMDEwMDY1MDY2NTAxNjQxYTE5MDA4MzAxNjUwNjY1MDE2NDFiMTkwMDgzMDExNDAwNjUwNjY1MDE2NDFjMTkwMDgzMDExNDAwNjQxZDZiMDI5MDAxNzNjZTY1MDM2NDAyODMwMTAxMDA2NTBlNjQxZWEwMGY2NTEwNjQxZjY0MjA4NDAwNjUwMTY0MjE2NDIyODUwMjE5MDA4MzAyYTEwMTgzMDE1YTExNjUxMWEwMTJhMTAwMDEwMDY0MWVhMDBmNjUxMWExMDE2NDIzNmIwMjkwMDI3MzBlNjUwMzY0MDI4MzAxMDEwMDY1MDE2NDI0MTkwMDY0MjU2YjAyOTAwMjczMjQ2NTAzNjQwMjgzMDEwMTAwNjUxMzY0MjY4MzAxMDEwMDY0MDQ1MzAwMjkyNzdhMDc2OTZlNzA3NTc0M2UyMGU5MjYwMDAwMDBlOTAxMDAwMDAwNjlkMjBkMDAwMDRlZTkwNjAwMDAwMDdhMDY1NTQ0NDM1NDQ2N2JlOWZmZmZmZmZmZmEwMTdkZTkwNTAwMDAwMGU5MDIwMDAwMDBlOTA3MDAwMDAwZTkwMzAwMDAwMGU5MDkwMDAwMDBlOTA4MDAwMDAwZTkwYTAwMDAwMGU5ZWIwMDAwMDBlOTc3MDAwMDAwZTkwYjAwMDAwMGU5MTgwMDAwMDA1YTFhMzMzMzM1NjYzNjMyMzMzMzM2MzUzNjY1MzU2NjM2MzIzNzM5MzczNDM3MzQzMzMzMzY2NWU5MWIwMDAwMDBlOTFmMDAwMDAwZTkxOTAwMDAwMGU5MWEwMDAwMDA2OTUyMmUwMDAwZTkxYzAwMDAwMGU5MWQwMDAwMDBlOTFlMDAwMDAwNjk2MDYzMDkwMGRhMDA2MzAxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxMDAwMDAwMDMwMDAwMDA0MzAwMDAwMDczMGMwMDAwMDA3NDAwNzQwMTdjMDA4MzAxODMwMTUzMDAyOTAxNGUyOTAyZGEwMzczNzQ3MmRhMDM2ZjcyNjQyOTAxZGEwMTc4YTkwMDcyMWMwMDAwMDBmYTA4NzQ3Mjc5NmQ2NTJlNzA3OWRhMDgzYzZjNjE2ZDYyNjQ2MTNlMjAwMDAwMDBmMzAwMDAwMDAwNzIxZTAwMDAwMGU5MjAwMDAwMDBlOTI1MDAwMDAwNWEwZTMwMzAzMDMxMzEzMTMxMzEzMTMxMzIzNTM1MzdlOTIyMDAwMDAwZGEwMTM0N2EwNzU5NmY3NTIwNzc2OTZlMjkxNGRhMDU2OTZlNzA3NTc0ZGEwMzc0NmQ3MGRhMDM2YzY1NmVkYTA0NjU3ODY5NzRkYTAzNzM3NTZkZGEwNjY1NmU2MzZmNjQ2NTcyMWEwMDAwMDBkYTAzNjM2ODcyZGEwMzY5NmU3NDcyMTkwMDAwMDA3MjFiMDAwMDAwZGEwMTc5ZGEwMzZkNjE3OGRhMDM2ODY1NzhkYTA0NmM2OTczNzRkYTA0NmE2ZjY5NmVkYTAzNmQ2MTcwZGEwMjc5NzlkYTA0NzM2ZjcyNzRkYTA1NzA3MjY5NmU3NDcyMWMwMDAwMDA3MjFjMDAwMDAwNzIxYzAwMDAwMDcyMWQwMDAwMDBkYTA4M2M2ZDZmNjQ3NTZjNjUzZTAxMDAwMDAwNzM0YTAwMDAwMDA4MDEwYzAxMDgwMTEwMDEwODAxMTAwMTA4MDEwYzAxMDgwMTFjMDEwODAxMmEwMTA4MDExYzAxMDgwMTBjMDEwYzAxMGUwMTA4MDExMDAxMDgwMTFhMDEwODAxMTIwMTA4MDExMjAxMDgwMTFlMDEwODAxMmEwMTA4MDEyMDAxMDgwMTEwMDEwODAxMGUwMTA4MDE) ä¸Š, é€‰æ‹© `From Hex`, å°è¯•èŽ·å–æ›´å¤šä¿¡æ¯.

äºŽæ˜¯æˆ‘ä»¬å¯ä»¥ä»Ž `output` ä¸­çœ‹åˆ°å¾ˆå¤šä»£ç å…³é”®å­—, ä½†æ˜¯æ²¡æœ‰åŠžæ³•ç¡®å®šæ˜¯ä»€ä¹ˆè¯­è¨€, å¯èƒ½å¤§æ¦‚çŽ‡æ˜¯ `python`.

![](/img/bluelens-ctf/hex.png)

ä¹‹åŽæˆ‘ä»¬å†å›žåˆ° `input` ä¸­, æ¥æ•²å®šä»£ç çš„è¯­è¨€. æˆ‘ä»¬é€šè¿‡[æœç´¢å‰å…­ä½çš„å‰ç¼€ `550d0d0a`](https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/specific-software-file-type-tricks/.pyc), å¯ä»¥ä»Žè¿™ä¸ª magic number ä¸­çŸ¥é“æ–‡ä»¶æ˜¯ `.pyc`.

ç„¶åŽæˆ‘ä»¬å†é€šè¿‡è„šæœ¬å°† `hex string` è½¬æ¢ä¸º binary compiler pyc æ–‡ä»¶.

```py
import binascii

hexString = "550d0d0a......"
binary = binascii.a2b_hex(c)

file = open('binary.pyc','wb')
file.write(binary)
```

å¾—åˆ° `binary.pyc` çš„æ–‡ä»¶åŽ, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `uncompyle6` æˆ–è€… [`PyC decompiler`](https://www.toolnb.com/tools-lang-en/pyc.html) æ¥åç¼–è¯‘è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶, å¾—åˆ° `.py` çš„æºç .

```py
# uncompyle6 version 3.5.0
# Python bytecode 3.8 (3413)
# Decompiled from: Python 2.7.5 (default, Nov 16 2020, 22:23:17)
# [GCC 4.8.5 20150623 (Red Hat 4.8.5-44)]
# Embedded file name: tryme.py
# Size of source mod 2**32: 880 bytes
tmp = input('input> ')
if not len(tmp) == 38:
    exit(1)
if not sum(tmp.encode()) == 3538:
    exit(1)
if not tmp[:6] == 'UDCTF{':
    exit(1)
if not tmp[(-1)] == '}':
    exit(1)
if not ord(tmp[5]) - 2 == ord(tmp[6]):
    exit(1)
if not tmp[7] == chr(int(str(ord(tmp[3]))[::-1])):
    exit(1)
if not ord(tmp[7]) - 9 == ord(tmp[9]):
    exit(1)
x = ord(tmp[8])
y = ord(tmp[10])
if not x + y == 235:
    exit(1)
if not max(x, y) < 119:
    exit(1)
if not tmp[11:24].encode().hex() == '335f6233656e5f62797474336e':
    exit(1)
if not tmp[24] == tmp[27]:
    exit(1)
if not tmp[27] == tmp[31]:
    exit(1)
if not ord(tmp[25]) * ord(tmp[26]) == 11858:
    exit(1)
if not ord(tmp[28]) * ord(tmp[29]) * ord(tmp[30]) == 615264:
    exit(1)
yy = list(''.join(map(lambda x: str(ord(x)), tmp[32:37])))
yy.sort()
if not ''.join(yy) == '00011111112557':
    exit(1)
if not tmp[34] == '4':
    exit(1)
print('You win')
```

äºŽæ˜¯æˆ‘ä»¬å¯ä»¥å¯¹è¿™ä¸ªä»£ç è¿›è¡Œåˆ†æž, å¾—åˆ° flag:
- å¯¹æ¯ä¸ªåˆ¤æ–­è¿›è¡Œé€æ­¥åˆ†æž, "ç¿»è¯‘" ä¸º `py` ä»£ç , ç›´æŽ¥å¾—åˆ°å¤§éƒ¨ä»½çš„ flag.
- å¯¹ flag çš„è¯­ä¹‰è¿›è¡ŒçŒœæµ‹, å¦‚æœ€åŽçš„ `sn4ke`, åœ¨æœ€åŽä¸€ä¸ªåˆ¤æ–­æ­ç¤ºä¸­é—´å­—ç¬¦ä¸º `4` åŽå°±å¯ä»¥ç»“åˆå‰é¢çš„å†…å®¹çŒœå‡ºè¿™ä¸ªè¯.

```py
import binascii
flag = 'U D C T F {'.split() + ['*'] * (38 - 6)
flag[6] = chr(ord(flag[5]) - 2)
flag[7] = chr(int(str(ord(flag[3]))[::-1]))
flag[9] = chr(ord(flag[7]) - 9)
flag[-1] = '}'
flag[34] = '4'
flag[8] = 'u'
flag[10] = 'v'
flag_0 = str(binascii.a2b_hex('335f6233656e5f62797474336e'))[2:-1]
flag_1 = ''.join(flag)[:11] + flag_0
flag[25] = 'y'
flag[26] = 'b'
flag[28] = 't'
flag[29] = 'f'
flag[30] = 'h'
flag_2 = '_'+'b'+'y'+'_'+'t'+'h'+'3' + '_'
print(flag_1 + flag_2 + 'sn4ke}')
```

## ðŸš© Flag

`UDCTF{y0u'v3_b3en_bytt3n_by_th3_sn4ke}`
